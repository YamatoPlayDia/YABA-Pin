import{g as d,b as n,d as o,c as r,a as l,u as m}from"./api-e53b87f9.js";import"./functions-5aea6087.js";async function c(){const e=await d(),a=await n("messages","writer_id",e),t=await n("messages","reader_id",e);let s=(await o("footprints")).find(i=>i.id===e);if(s||(await r("footprints",{id:e,rights_write:1,rights_read:0}),s=await l("footprints",e)),!t||t.status!=="収得済み")s.rights_read==1?(document.getElementById("rightsBottle").setAttribute("src","img/kara_fullbottle.png"),document.getElementById("readBtn").classList.remove("hidden"),document.getElementById("throwBtn").classList.remove("hidden")):s.rights_read==0&&(document.getElementById("rightsBottle").setAttribute("src","img/kara_karabottle.png"),document.getElementById("throwBtn").classList.remove("hidden"));else if(t.status==="収得済み")s.rights_read==1?(document.getElementById("rightsBottle").setAttribute("src","img/kara_fullbottle.png"),document.getElementById("readBtn").classList.remove("hidden"),document.getElementById("throwBtn").classList.remove("hidden")):s.rights_read==0&&(document.getElementById("rightsBottle").setAttribute("src","img/kara_karabottle.png"),document.getElementById("readStillBtn").classList.remove("hidden"),document.getElementById("throwBtn").classList.remove("hidden"));else{const i={...s,rights_read:0};await m("footprints",e,i),document.getElementById("rightsBottle").setAttribute("src","assets/img/palebottole.png"),document.getElementById("throwBtn").classList.remove("hidden")}document.getElementById("throwBtn").addEventListener("click",async()=>{!a||a.status!=="下書き"?(await r("messages",{writer_id:e,himitsu:"あなたの秘密をここにお書きください",status:"下書き"}),window.location.href="/message_insert"):a.status==="下書き"&&(window.location.href="/message_insert")}),document.getElementById("readBtn").addEventListener("click",async()=>{!t||t.status!=="収得済み"?window.location.href="/map_read":t.status==="収得済み"&&(window.location.href="/reading_view")}),document.getElementById("readStillBtn").addEventListener("click",async()=>{!t||t.status!=="収得済み"?window.location.href="/map_read":t.status==="収得済み"&&(window.location.href="/reading_view")})}c();
